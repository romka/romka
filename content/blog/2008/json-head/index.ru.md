---
title: Получение заголовков (HTTP-headers) страницы при помощи Java-script
date: 2008-09-15 14:48:32 +0400
draft: false
tags: [old-site, jquery, java-script, Штуки-дрюки]
deprecated: true
---
В  журнале [Smashing Magazine](http://www.smashingmagazine.com) наткнулся на [скрипт](http://natbat.net/2008/Aug/27/addSizes/) (плагин для jQuery), позволяющий автоматически рядом с ссылками указывать размер файла, на который указывает эта ссылка. Оказалось, что этот скрипт в своей работе использует полезный сервис, под названием [json-head](http://json-head.appspot.com/), который на входе принимает любой URL, а на выходе в формате [JSON](http://json.org) отдает заголовки, которые получил от сервера.

Анализируя эти заголовки можно на стороне клиента придумать много полезных фишек, кроме указания размера документа, на который ведет ссылка, можно, например, подсвечивать ссылки на недавно обновленные страницы (заголовок "_Last-Modified_") или нерабочие ссылки (анализ переменной "_status_code_").

Все те же действия можно проделывать и не используя сторонние сервисы, но в таком случае опрос удаленных серверов и анализ заголовков придется реализовать на стороне своего сервера, со всеми вытекающими отсюда достоинствами (независимость от сторонних сервисов и того, включена на стороне клиента поддержка Java-script или нет) и недостатками (в случае большого количества запросов забанят ip вашего сервера, а не ip сервера http://json-head.appspot.com ну и необходимость разработки собственного решения).

_Кстати, с помощью этого сервиса, совершенно случайно выяснил, что Гугл работает с использованием веб-сервера собственной разработки &mdash; [gws](http://en.wikipedia.org/wiki/Google_Web_Server), по данным из Википедии на этом ПО работает 9,3% всех сайтов в интернете, то есть Гугл &mdash; это и есть почти 10% интернета!_
<!--more-->
## Пример использования
Пример приведу на основе скрипта, указывающего размер документа, на который ведет ссылка. Работать со скриптом просто, его надо <a href="http://natbat.net/code/clientside/js/addSizes/addSizes.js">скачать</a> и подключить к своей странице:
```
<script src="jquery.js" type="text/javascript" charset="utf-8"></script>
<script src="addSizes.js" type="text/javascript" charset="utf-8"></script>
```
После чего все ссылки на файлы с расширениями *.mp3, *.pdf, *.doc будут дополнены информацией о размерах файлов. 

**Внимание!** Важно учитывать то, что информация о размере файла берется из HTTP-заголовка "_Content-Length_", некоторые веб-сервера могут его не отдавать и для ссылок на файлы с таких серверов размер указан не будет.

Скрипт addSizes.js можно легко модифицировать под свои цели, например можно добавить показ размера для всех внешних ссылок, для этого строчку:
```
$('a[href$=".pdf"], 'a[href$=".doc"], a[href$=".mp3"], a[href$=".m4u"]).each(function(){
```
нужно доработать таким образом:
```
$('a[href$=".pdf"], 'a[href$=".doc"], a[href$=".mp3"], a[href$=".m4u"], a[target$=_blank]').each(function(){
```
Кроме того, я рекомендую заменить строчку:
```
link.after(' (' + type + ' ' + length + ' ' + lengthUnits + ')');
```
на:
```
link.after(' <span class="filesize">(' + type + ' ' + length + ' ' + lengthUnits + ')</span>');
```
для того, чтобы с помощью CSS можно было бы управлять внешним видом блока с информацией.

Работающий пример находится [здесь](/old-site/examples/autosize/index.html), в нем я, кроме вывода информации о размере документа, добавил вывод даты его последнего изменения, в случае если нет заголовка "_Content-Length_".

P.S. Хотите быстрее всех получать информацию об обновлениях на этом сайте? Тогда [подпишитесь на RSS-канал](http://feeds.feedburner.com/romkaeu) ;)