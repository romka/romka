---
title: Темизация Drupal. Часть 2. Анатомия темы оформления Drupal
date: 2010-01-03 20:11:43 +0300
draft: false
tags: [old-site, Drupal, статья, темизация]
---
Как и в случае с модулем, разработка которого рассматривалась в [предыдущей статье]({{< relref "drupal-article-2-part-1-drupal-develop-module-vvedenie" >}}), тема оформления должна иметь уникальное имя, состоящее из строчных латинских букв, цифр и знаков подчеркивания, и это имя должно начинаться с буквы. Тема оформления — это несколько файлов, которые располагаются в папке _sites/all/themes/имя_темы_ относительно корня Drupal.

PHPTemplate при сборке страницы берет информацию из пяти основных файлов: _имя_темы.info_, _page.tpl.php_, _node.tpl.php_, _block.tpl.php_, _template.php_. Если же включен модуль _comment_, для вывода комментариев используется шаблон _comment.tpl.php_.
<!--more-->
Файл **_имя_темы.info_** содержит служебную информацию: название и описание темы оформления, список используемых в ней *.css- и *.js-файлов и список регионов (ссылку на подробное описание всех параметров, используемых в *.info-файле темы, можно найти во врезке в конце статьи). Данные, находящиеся в этом файле, кэшируются в базе данных, и чтобы внесенные в него изменения вступили в силу, нужно этот кэш сбросить. Самый простой способ сделать это — просто зайти на страницу со списком тем и нажать кнопку Save configuration; при этом сбросится только закэшированная информация из *.info-файла, но не весь кэш сайта.

**_Page.tpl.php_** — это основной шаблон, в нем размещается HTML-код всей страницы, которая позже будет выведена пользователю. В частях страницы, где будет выводиться содержимое регионов и основной текст, должны располагаться соответствующие переменные. Например, если в *.info-файле не указано иное, то в каждой теме оформления присутствует пять основных регионов (их описание я давал выше), которые представлены переменными $left, $right, $header, $footer, $content. В первых четырех переменных выводятся блоки, размещенные в соответствующих регионах, в переменной $content находится основное содержимое страницы, а это или шаблон node.tpl.php (если просматривается документ, — например, новость или запись в блоге) с выведенными в нем данными, или страница, созданная каким-либо модулем, — например, список, генерируемый модулем Views.

В файле page.tpl.php, кроме перечисленных выше, может находиться еще десяток переменных, выполняющих разные функции: $primary_links, $secondary_links, $search_box, $tabs, $messages, $breadcrumbs, $closure и т. д. Все они важны. При необходимости описание всех доступных в page.tpl.php переменных можно найти по ссылке, размещенной во врезке в конце статьи.

Часто бывает нужно создать разное оформление для страниц сайта. Движок PHPTemplate имеет необходимые для этой задачи возможности. Чтобы задать свой шаблон для определенной страницы, следует в папке с темой оформления создать копию файла page.tpl.php и присвоить ей имя, соответствующее одной из масок: _page-front.tpl.php_ будет использоваться как шаблон для главной страницы сайта; а page-путь_к_внутренней_странице.tpl.php — как шаблон для указанной внутренней страницы; _page-node.tpl.php_ — при просмотре материала; _page-node-nid.tpl.php_, где nid — id документа — при просмотре документа с указанным id; _page-node-edit.tpl.php_ используется при редактировании документа. Кроме того, вы можете использовать шаблоны _maintenance-page.tpl.php_ и _maintenance-page-offline.tpl.php_, которые будут выводиться в случае ошибок соединения с базой данных или в случае перевода сайта в offline-режим.

_**Node.tpl.php**_ — шаблон, по умолчанию используемый для вывода содержимого документа. В шаблоне node.tpl.php размещается HTML-код, задающий форматирование документов, таких как Страницы (Page) и Новости (Story); в нем доступны переменные $title, $teaser, $content, содержащие заголовок, анонс и полный текст документа, а также ряд служебных переменных.

При просмотре страницы, скажем, с текстом новости выводится шаблон страницы _page.tpl.php_, в котором в регионе, отведенном для вывода основного содержимого (переменная _$content_), размещается содержимое шаблона _node.tpl.php_. Как и в случае с общим макетом страницы (_page.tpl.php_), для каждого типа документа может быть определен свой шаблон — так, часто для новостей используется один макет, для статических страниц другой, а для фотографий — третий. Чтобы определить свой шаблон для каждого типа контента, в папке с темой оформления нужно создать копию файла _node.tpl.php_ и дать ей имя _node-имя_типа_контента.tpl.php_, т. е., например, файл _node-blog.tpl.php_ будет использоваться для отображения записей в блоге, а _node-book.tpl.php_ — для отображения страниц книги.

_**Block.tpl.php**_ — определяет внешний вид блока; как и в случае с материалами, шаблон блока может быть задан для каждого модуля (блоки, создаваемые модулем user, будут использовать один шаблон, а блоки, создаваемые модулем block, — другой) или для каждого блока в отдельности. Маски имен файлов шаблонов для блоков имеют вид: шаблон _block-module_name.tpl.php_ и используется для всех блоков, создаваемых модулем module_name; шаблон _block-module_name-delta.tpl.php_ может использоваться в случае, если модуль создает несколько блоков и вы хотите каждому из них задать свой шаблон. Параметр delta — это id блока, который задается создающим его модулем. Шаблон _block-region.tpl.php_ служит для отображения блока в определенном регионе.

Каждый модуль, написанный с применением слоя темизации Drupal, должен разделять функции, генерирующие данные, и функции темизации, оформляющие эти данные в виде HTML-кода. Функции темизации регистрируются модулями через специальный хук [hook_theme()](http://api.drupal.org/api/function/hook_theme/6) и имеют имена, начинающиеся с префикса theme_, например, [theme_list()](http://api.drupal.org/api/function/theme_list/6). Такие функции не реализуют никакой бизнес-логики, а только получают набор данных на входе и отдают сформированный HTML-код на выходе. Функции темизации могут быть переопределены в файле template.php, т. е. разработчик может заменить стандартное оформление данных, возвращаемых модулем, по своему желанию. Для этого нужно скопировать в него соответствующую функцию темизации, заменить в ней префикс theme_ на имя используемой темы и внести в нее необходимые изменения.

Из всех перечисленных выше файлов обязательный только _*.info_, в случае отсутствия в папке с темой файлов _page.tpl.php_, _node.tpl.php_, _block.tpl.php_ или _template.php_ будут использоваться стандартные шаблоны. Ссылку на список стандартных шаблонов можно найти в конце статьи.


### На заметку: полезные модули

[Signwriter](http://drupal.org/project/signwriter). Часто бывает необходимо использовать в заголовке страницы или меню какой-либо экзотический шрифт, отсутствующий у большинства посетителей сайта. Модуль Signwriter генерирует картинки с текстом, написанным заданным шрифтом (шрифт предварительно должен был закачан на сервер). Через меню администратор может включить замену заголовков страниц и блоков созданными картинками, а через специальную функцию и вовсе можно заменить картинками любой текст.

[Blocktheme](http://drupal.org/project/blocktheme). Не всегда удобно создавать и закачивать на сервер шаблоны под каждый используемый на сайте блок. Кроме того, реализованная в Drupal система масок имен для шаблонов не для всех задач бывает достаточно гибкой. Модуль Blocktheme позволяет через интерфейс управления блоками выбрать для каждого из них один из заранее созданных шаблонов.

[Devel](http://drupal.org/project/devel). Мощный инструмент в руках Drupal-разработчика. Разработчику тем оформления модуль Devel предоставляет информацию обо всех используемых для генерации страницы шаблонах и функциях темизации.

[PNG Fix](http://drupal.org/project/pngfix). Модуль, исправляющий проблему с непрозрачностью PNG-файлов в браузерах IE 5.5 и IE 6. Настраивается работа модуля через интерфейс администратора, изменение файлов темы оформления не требуется.

Кроме переменных, содержащих видимые пользователю данные, в шаблоне page.tpl.php должно размещаться несколько служебных переменных. Скажем, между тегами страницы располагаются переменные $head, $styles, $scripts. В этих переменных Drupal собирает HTML-код, добавляющий к странице мета-теги, файлы стилей и java-скрипты соответственно. Наличие этих трех переменных позволяет программистам в своих модулях, используя API-функции [drupal_add_css()](http://api.drupal.org/api/function/drupal_add_css/6), [drupal_add_js()](http://api.drupal.org/api/function/drupal_add_js/6) и некоторые другие, добавлять к странице свои стили или другие файлы, не изменяя файлов темы оформления.

**Листинг 1**
```
name = Theme name
description = Theme description.
version = VERSION
core = 6.x
engine = phptemplate
stylesheets[all][] = style.css
stylesheets[print][] = print.css
scripts[] = effects.js
scripts[] = menu.js
regions[left] = Left sidebar
regions[content] = Content
regions[header] = Header
regions[footer] = Footer
```
Обычно _*.info_-файл темы оформления содержит конфигурационные данные (см. листинг 1). В первых двух строчках файла обычно указывается имя и дается описание темы оформления, которое будет выводиться в интерфейсе администратора в списке доступных тем. Далее указываются версия ядра Drupal, для которой написана эта тема, и используемый шаблонизатор.

Параметры _stylesheets _определяют список CSS-файлов, которые будут подключены ко всем страницам. В первой паре квадратных скобок через запятую может быть указан список параметров, присваиваемых атрибуту _media_ HTML-тега link (подробную информацию о назначении этого атрибута можно найти по ссылке во врезке в конце статьи). Из перечисленных здесь имен файлов, а также из файлов стилей, которые подключены модулями через функцию [drupal_add_css()](http://api.drupal.org/api/function/drupal_add_css/6), будет сформирован HTML-код, подключающий указанные стили и доступный в шаблоне page.tpl.php в переменной $styles. Кроме того, шаблонизатор попытается найти в папке с темой оформления файл style.css; если он есть, то он также будет подключен к странице.

Аналогичное назначение и у параметра _scripts_. Перечисленные в нем JavaScript, а также сценарии, добавленные модулями через функцию [drupal_add_js()](http://api.drupal.org/api/function/drupal_add_js/6), будут подключены ко всем страницам сайта. Если в папке с темой оформления есть файл script.js, он также будет подключен к каждой странице.

Параметры _regions _определяют список доступных в шаблоне page.tpl.php регионов. Значение в скобках станет PHP-переменной, например_ $left_ или _$footer_ (поэтому здесь недопустимо использовать пробелы, дефисы и другие запрещенные в именах PHP-переменных символы), а значение после знака «равно» — именем региона, доступным на странице управления блоками.

Файл _page.tpl.php_ при использовании приведенного выше _*.info_-файла может иметь структуру подобную приведенной в листинге 2.

**Листинг 2**
```
<HTML>
  <head>
    <font class="comment_title"><?php print $head_title ?></font>
    <?php print $head ?>
    <?php print $styles ?>
    <?php print $scripts ?>
  </head>
  <body>
    <div class="header">
      <?php print $header ?>
    </div>    <div class="left-sidebar">
      <?php print $left ?>
    </div>    <div class="content">
      <?php print $content ?>
    </div>    <div class="footer">
      <?php print $footer ?>
    </div>  </body>
</HTML>
```
Это очень простой пример, призванный продемонстрировать общую логику разработки темы оформления для Drupal, поэтому здесь опущено много деталей. Лучший способ научиться темизировать Drupal — изучить существующую тему оформления, например тему [Zen](http://drupal.org/project/zen). Она содержит детальное описание всех используемых стилей и переменных.

Переменные _$header_, _$left_ и _$footer_ в нашем примере будут заполнены HTML-кодом блоков, которые администратор сайта разместит в соответсвующих регионах. В переменной _$head_title_ будет находиться загловок страницы, «склеенный» Drupal из имени сайта и заголовка текущей страницы, а переменные _$head_, _$styles_ и _$scripts_ будут заменены соответственно метатегами, ссылками на файлы стилей и JavaScript.

Переменная _$content_ в шаблоне _page.tpl.php_ заменится на содержимое текущей страницы, например на тело документа (шаблон _node.tpl.php_) или содержимое, генерируемое каким-либо модулем. Если в текущей теме оформления нет файла node.tpl.php, то используется одноименный файл из ядра Drupal, находящийся в папке _modules/node_.

В шаблоне _node.tplp.php_ доступно несколько переменных, самые важные из них: _$title_ — заголовок документа, _$node_ — объект, содержащий полную информацию о текущем документе, _$submitted_ — HTML-код, содержащий информацию об авторе документа, _$content_ — основное содержимое (тело) текущего документа. Не путайте переменную _$content_ из шаблона _node.tpl.php_ с одноименной переменной из шаблона _page.tpl.php_. В первой есть только «тело» текущего документа без дополнительной информации (автор, дата публикации и т. д.), а во второй — полный HTML-код, который будет показан пользователю в регионе content. Например, при просмотре ленты последних новостей переменная _$content_ каждой новости будет содержать текст одной новости, а переменная _$content_ в шаблоне _page.tpl.php_ — HTML-код всех выводимых новостей (см. картинку «Описание схемы страницы»).

Самый простой пример шаблона _node.tpl.php_ см. в листинге 3.

**Листинг 3**
```
<div class="node<?php if ($sticky) {
    print " sticky";
  } ?>
  <?php if (!$status) {
    print " node-unpublished"; 
  } ?>">
  <h2 class="title"><?php print $title?></h2>
  <span class="submitted"><?php print $submitted?></span>
  <div class="content"><?php print $content?></div></div>
```

Все переменные, которые выводятся в шаблоне _page.tpl.php_, могут быть переопределены в функции [phptemplate_preprocess_page()](http://api.drupal.org/api/phptemplate_preprocess_page/6), размещенные в файле _template.php_ текущей темы оформления. Аналогично все переменные шаблона _node.tpl.php_ могут быть переопределены в функции [phptemplate_preprocess_node()](http://api.drupal.org/api/function/phptemplate_preprocess_node/6). Кроме того, в этих функциях могут быть определены дополнительные переменные, которые станут доступны в соответствующих шаблонах. Пример практического использования данных функций <a href="http://api.drupal.org">можно найти в документации</a> или в одной из существующих тем оформления.

Ссылки на другие части этой статьи:
- [Часть 1. Введение]({{< relref "drupal-article-3-part-1-drupal-themeing" >}})
- **Часть 2. Анатомия темы оформления**
- [Часть 3. Forms API и темизация]({{< relref "drupal-article-3-part-3-drupal-forms-api" >}})
- [Часть 4. Темизация Views]({{< relref "drupal-article-3-part-4-drupal-themeing-views" >}})

Содержание всех статей: [/blog/2010/my-drupal-articles]({{< relref "my-drupal-articles" >}})