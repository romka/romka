(function(A){A.fn.columnize=function(B){var C={width:400,columns:false,buildOnce:false};var B=A.extend(C,B);return this.each(function(){var H=A(this);var K=H.height();var L=A("<div></div>");var D=0;var G=false;L.append(H.children().clone());J();A(window).resize(function(){if(!B.buildOnce&&A.browser.msie){if(H.data("timeout")){clearTimeout(H.data("timeout"))}H.data("timeout",setTimeout(J,200))}else{if(!B.buildOnce){J()}else{}}});function F(O,S,U,V){while(U.height()<V&&S[0].childNodes.length){O.append(S[0].childNodes[0])}if(O[0].childNodes.length==0){return }var N=O[0].childNodes;var P=N[N.length-1];O[0].removeChild(P);var T=A(P);if(T[0].nodeType==3){var R=T[0].nodeValue;var Q=B.width/8;var M;while(U.height()<V&&R.length){if(R.indexOf(" ",Q)!="-1"){M=R.substring(0,R.indexOf(" ",Q))}else{M=R}O.append(document.createTextNode(M));if(R.length>Q){R=R.substring(R.indexOf(" ",Q))}else{R=""}}if(R.length){T[0].nodeValue=R}else{return }}if(S.children().length){S.prepend(T)}else{S.append(T)}}function I(N,P,O,M){if(P.children().length){$cloneMe=P.children(":first");$clone=$cloneMe.clone();if($clone.attr("nodeType")==1){N.append($clone);if($clone.is("img")&&O.height()<M+20){$cloneMe.remove()}else{if(!$cloneMe.hasClass("dontsplit")&&O.height()<M+20){$cloneMe.remove()}else{if($clone.is("img")||$cloneMe.hasClass("dontsplit")){$clone.remove()}else{$clone.empty();F($clone,$cloneMe,O,M);if($cloneMe.children().length){I($clone,$cloneMe,O,M)}}}}}}}function E(){if(H.data("columnized")&&H.children().length==1){return }H.data("columnized",true);H.data("columnizing",true);H.empty();H.append(A("<div class='first last column' style='width:98%; padding: 3px; float: left;'></div>"));$col=H.children().eq(H.children().length-1);$col.append(L.clone());H.data("columnizing",false)}function J(){if(D==H.width()){return }D=H.width();var O=Math.round(H.width()/B.width);if(B.columns){O=B.columns}if(O<=1){return E()}if(H.data("columnizing")){return }H.data("columnized",true);H.data("columnizing",true);H.empty();H.append(A("<div style='width:"+(Math.round(100/O)-2)+"%; padding: 3px; float: left;'></div>"));a=H.children(":last");a.append(L.clone());K=a.height();H.empty();var S=K/O;var N=true;var T=3;for(var W=0;W<T;W++){H.empty();var U=L.clone();U.css("visibility","hidden");for(var R=0;R<O;R++){var V=(R==0)?"first column":"column";var V=(R==O-1)?("last "+V):V;H.append(A("<div class='"+V+"' style='width:"+(Math.round(100/O)-2)+"%; float: left;'></div>"))}for(var R=0;R<O-1;R++){var a=H.children().eq(R);F(a,U,a,S);I(a,U,a,S)}a=H.children().eq(H.children().length-1);while(U.children().length){a.append(U.children(":first"))}var Z=a.height();var Y=Z-S;var M=0;var Q=10000000;var X=0;H.children().each(function(b){return function(c){var d=b.children().eq(c).height();M+=d;if(d>X){X=d}if(d<Q){Q=d}}}(H));var P=M/O;if(X-Q>30){S=P+30}else{if(Math.abs(P-S)>20){S=P}else{W=T}}H.append(A("<br style='clear:both;'>"))}H.data("columnizing",false)}})}})(jQuery);
