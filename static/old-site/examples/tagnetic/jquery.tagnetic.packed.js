/*
 * Tagnetic — plugin for jQuery 1.2.6
 *
 * Copyright (c) 2008 Roman Arkharov http://romka.eu
 *
 * Date: 2008-10-13
 */
jQuery.tagnetic=function(e){var f={container:"ul#tagnetic",tag:"li",new_container_name:"new-tagnetic",div_width:600,path_to_skins:"",skin:'refrigerator-600',paddings:30,margin:5,background_top:"background-top.jpg",background_middle:"background-middle.jpg",background_bottom:"background-bottom.jpg",handle:'none',handle_width:275,handle_line:5,ovals:1,squares:8,beat_x:4,beat_y:4,ellipse_width:"70,50",ellipse_height:"29,21",ellipse_text_width:"60,35",ellipse_text_height:"19,18",loader:true,loader_max_time:15000};var e=$.extend(f,e);if(e.tag=="none"){$(e.container+" a").each(function(){$(this).wrap("<li class=\"tag\"></li>")});e.tag="li"}c=0;function imagesLoadCounter(i,j){alert(i+"; "+j);c++}squares=Array();for(i=1;i<=e.squares;i++){squares[i]=Array();for(j=0;j<=8;j++){squares[i][j]=new Image()}squares[i][0].src=e.path_to_skins+"skins/"+e.skin+"/squares/square-l-t-"+i+".png";squares[i][1].src=e.path_to_skins+"skins/"+e.skin+"/squares/square-m-t-"+i+".png";squares[i][2].src=e.path_to_skins+"skins/"+e.skin+"/squares/square-r-t-"+i+".png";squares[i][3].src=e.path_to_skins+"skins/"+e.skin+"/squares/square-l-m-"+i+".png";squares[i][4].src=e.path_to_skins+"skins/"+e.skin+"/squares/square-m-m-"+i+".png";squares[i][5].src=e.path_to_skins+"skins/"+e.skin+"/squares/square-r-m-"+i+".png";squares[i][6].src=e.path_to_skins+"skins/"+e.skin+"/squares/square-l-b-"+i+".png";squares[i][7].src=e.path_to_skins+"skins/"+e.skin+"/squares/square-m-b-"+i+".png";squares[i][8].src=e.path_to_skins+"skins/"+e.skin+"/squares/square-r-b-"+i+".png"}e.ellipse_width+=",0";e.ellipse_height+=",0";e.ellipse_text_width+=",0";e.ellipse_text_height+=",0";ew=Array();ew=e.ellipse_width.split(",");eh=Array();eh=e.ellipse_height.split(",");etw=Array();etw=e.ellipse_text_width.split(",");eth=Array();eth=e.ellipse_text_height.split(",");ellipses=9999;for(i=0;i<=ew.length-1;i++)ew[i]=parseInt(ew[i]);if(i<=ellipses)ellipses=i;for(i=0;i<=eh.length-1;i++)eh[i]=parseInt(eh[i]);if(i<=ellipses)ellipses=i;for(i=0;i<=etw.length-1;i++)etw[i]=parseInt(etw[i]);if(i<=ellipses)ellipses=i;for(i=0;i<=eth.length-1;i++)eth[i]=parseInt(eth[i]);if(i<=ellipses)ellipses=i;ellipses--;margins=e.margin*2;function randOrd(){return(Math.round(Math.random())-0.5)}function rand(){return(1+Math.round(Math.random()*(e.squares-1)))}function buildMagnet(a,b,c,d){d=d||0;rnd=rand();el=false;for(k=0;k<=ellipses;k++){if(a>0.75*etw[k]&&a<etw[k]&&b>0.75*eth[k]&&b<eth[k]&&!el&&Math.round(Math.random())==1){el=true;magnet="<div class=\"tc\"><table class=\"\magnet\" style=\"width: "+ew[k]+"px; height: "+eh[k]+"px; background: url("+e.path_to_skins+"skins/"+e.skin+"/ellipses/ellipse-"+(k+1)+".png) no-repeat;\"><tr><td><div style=\"display: block; text-align: center; width: "+ew[k]+"px; height: "+eh[k]+"px; text-align: center; vertical-align: middle;\" class=\"tag_line "+d+"\">"+c+"</div></td></tr></table></div>";return magnet}}if(!el){magnet="<div class=\"tc\"><table class=\"magnet\"><tr><td class=\"corner\"><img src=\""+squares[rnd][0].src+"\"></td>";magnet+="<td style=\"background: url("+squares[rnd][1].src+") repeat-x;\"></td>";magnet+="<td class=\"corner\"><img src=\""+squares[rnd][2].src+"\"></td></tr>";magnet+="<tr><td class=\"corner\" style=\"background: url("+squares[rnd][3].src+") repeat-y;\"></td>";magnet+="<td style=\"background: url("+squares[rnd][4].src+");\"><div style=\"display: inline; float: left; width: "+a+"px; height: "+b+"px;\" class=\"tag_line "+d+"\">"+c+"</div></td>";magnet+="<td class=\"corner\" style=\"background: url("+squares[rnd][5].src+") repeat-y;\"></td></tr>";magnet+="<tr><td class=\"corner\"><img src=\""+squares[rnd][6].src+"\"></td>";magnet+="<td style=\"background: url("+squares[rnd][7].src+") repeat-x;\"></td>";magnet+="<td class=\"corner\"><img src=\""+squares[rnd][8].src+"\"></td></tr></table></div>";return magnet}else{return""}}var g=Array();var i=0;var h=200;var l=0;var m=200;var n=0;$(e.container+" > "+e.tag).each(function(){$(this).css({display:"inline"});g[i]=Array();g[i]['width']=$(this).width();g[i]['height']=$(this).height();g[i]['data']=$(this).html();g[i]['size']=$(this).attr("class");g[i]['used']=false;if(g[i]['height']>l)l=g[i]['height'];if(g[i]['height']<h)h=g[i]['height'];if(g[i]['width']<m)m=g[i]['width'];if(g[i]['width']>n)n=g[i]['width'];$(this).append("<span style=\"display:none\">["+g[i]['data']+"] w/h = "+g[i]['width']+"/ "+g[i]['height']+"</span>");$(this).append("<br>");i++});g.sort(randOrd);var o=Array();ratio=Math.round(l/h);j=0;mh=0;for(i=0;i<=g.length-1;i++){if(g[i]['height']<=(l/2)+margins&&g[i]['used']==false){g[i]['used']=true;if(mh==0){o[j]=Array();o[j]['data']="<div class=\"tag container\" id=\"tag-block-"+j+"\">";o[j]['width']=g[i]['width']+e.paddings;lines=0}o[j]['data']+=buildMagnet(g[i]['width'],g[i]['height'],g[i]['data'],g[i]['size']);lines++;if(g[i]['width']+e.paddings>o[j]['width'])o[j]['width']=g[i]['width']+e.paddings;mh+=g[i]['height'];if(mh+h>=l&&lines>1){o[j]['data']+="</div>";j++;mh=0}}}if(mh!=0){o[j]['data']+="</center></div>";j++}for(i=0;i<=g.length-1;i++){if(g[i]['height']>(l/2)+5&&g[i]['used']==false){g[i]['used']=true;o[j]=Array();o[j]['width']=g[i]['width']+e.paddings;o[j]['data']="<div class=\"tag single\" id=\"tag-block-"+j+"\">";o[j]['data']+=buildMagnet(g[i]['width'],g[i]['height'],g[i]['data'],g[i]['size']);o[j]['data']+="</div>";j++}}o.sort(randOrd);result="";result+="<div class=\"bl\"><img src=\""+e.path_to_skins+"skins/"+e.skin+"/"+e.background_top+"\"></div><div class=\"clr\"></div>";result+="<div id=\"magnets\"><div class=\"nl\">";j=0;k=0;is_k=true;lines_counter=1;for(i=0;i<=o.length-1;i++){if(j+margins+e.paddings+o[i]['width']>e.div_width){result+="</div><div class=\"clr\"></div><div class=\"nl\">";j=0;if(is_k)lines_counter++}if(k>=e.handle_line&&is_k&&j==0&&e.handle!='none'){result+="<div id=\"tagnetic-handle\" style=\"float: left; position: relative; width: "+e.handle_width+";\"><img src=\""+e.path_to_skins+"skins/"+e.skin+"/"+e.handle+"\"></div>";j+=e.handle_width+margins;is_k=false}else{result+=o[i]['data'];j+=o[i]['width']+margins;k++}}if(j!=0)result+="</div><div class=\"clr\"></div>";result+="</div><div class=\"bl\"><img src=\""+e.path_to_skins+"skins/"+e.skin+"/"+e.background_bottom+"\"></div><div class=\"clr\"></div>";$(e.container).after("<div id=\""+e.new_container_name+"\" style=\"background: url('"+e.path_to_skins+"skins/"+e.skin+"/"+e.background_middle+"') repeat-y; width: "+e.div_width+"px; text-align: center;\"></div>").remove();$("div#"+e.new_container_name).html(result);$("div.container > div.tc > table.magnet").each(function(){padd=Math.round(10+Math.random()*(($(this).parent().width()-10)/e.beat_x));if($(this).width()<$(this).parent().width()*0.75){$(this).parent().css({"padding-left":padd})}});if(e.loader){$("div#magnets").css({visibility:"hidden"});$("div#magnets").before("<div id=\"tagnetic-loader\"><img src=\""+e.path_to_skins+"ajax-loader.gif\"></div>");$(window).load(function(){$("div#tagnetic-loader").remove();$("div#magnets").css({visibility:"visible"})});si=setInterval('$("div#tagnetic-loader").remove();$("div#magnets").css({visibility: "visible"}); clearInterval(si);',e.loader_max_time)}i=0;nl_height=0;$("div#"+e.new_container_name+" > div#magnets > div.nl").each(function(){i++;nl_height+=$(this).height();if(i!=lines_counter||e.handle=='none'){marg=Math.round((e.div_width-$(this).width())/3);$(this).css({"padding-left":marg})}});nl_height=nl_height/i/e.beat_y;$(e.new_container_name+" > div#magnets > div.nl > div.tag").each(function(){if(Math.round(Math.random())==1)s=true;else s=false;if(s)$(this).css({"margin-top":Math.round((nl_height/2)+Math.random()*(nl_height/2))})})};